Alerts
======

The types of alerts that can be generated by *Job Monitors* are the
following:

===================== ========================= ======================
Name                  Description               Clearing conditions
===================== ========================= ======================
clamps_closed_event   Triggered when the driver Cleared when the
                      closes the clamps in a    truck moves away
                      location which is a       from the location
                      correct origin for the    where the clamps
                      ongoing job.              were closed.
clamps_closed_warning Triggered when the driver Cleared at the first
                      closes the clamps in a    clamp event that takes
                      location which is not a   place in a correct
                      correct origin or         location.
                      destination for the
                      ongoing job.
remaining_tasks       Items were dropped at a   Cleared when all tasks
                      correct destination, but  that had the alert
                      there are still missing   location as
                      tasks which had that      destination are
                      drop location as          completed.
                      destination.
drop_items            Incorrect items were      Cleared when the
                      dropped at a location     incorrect items are
                      which is a correct drop   brought back to their
                      location for the ongoing  original location.
                      job.
drop_location         Items were dropped at a   Cleared when the items
                      location which is not a   are brought back to
                      correct drop location for their original
                      the ongoing job.          location.
===================== ========================= ======================

Clamp event notifications
-------------------------

Alerts of types *clamps_closed_event* and *clamps_closed_warning* do not imply
that a driver error has occurred, unlike the other types of alerts. They only
notify the front end that the clamps on a given truck have been closed in a
correct location, if the alert is of type clamps_closed_event, or in a wrong
location, if the alert is of type *clamps_closed_warning*. These notifications
do not implythat the clamp truck is actually carrying items, as they are simply
triggered when the clamps are closed, regardless of what the tag reader is
detecting.

Alerts of type *clamps_closed_event* may be helpful to the front end in
displaying the next destination in the ongoing job at the appropriate moment
(i.e. pickup at correct location).

Alerts of type *clamps_closed_warning* instead warn the front end, which may in
turn warn the driver, that the clamps have been closed in a location where the
truck was not supposed to pick up any item. This warning may be useful in
preventing the driver from picking up at wrong locations by displaying an
immediate warning when closing the clamps, even though the alleged error hasn’t
been confirmed yet.


Identifying error situations
----------------------------

*drop_items* alerts are generated whenever incorrect items are dropped at a
correct location. There are different reasons for the incorrectness of these
items:

- Items are the wrong model.
- Items are the correct model, but their *serial_lock* is active.
- Items are the correct model and not “serial locked”, but the clamp truck
  carried a higher quantity than requested.

To identify which situation an item-related alert belongs to, the front end can
join with the *items* table on the *alerts.item_id* column, to find out the
model and serial lock status of each item.

Given a *drop_items* alert with job ID **w**, item ID **x** and location ID
**y**, the front end can discover if item **x**’s model is correct or not by
checking whether it belongs to the set of correct models for that job and
location, which is defined as follows:

::

  SELECT DISTINCT t.model
  FROM   jobs j, job_tasks jt, tasks t
  WHERE	 jt.job_id = j.id
  AND 	 jt.task_id = t.id
  AND 	 j.id = w
  AND 	 t.destination = y

Displaying alert information
----------------------------

In case of drop alerts, the front end can select the value of the
*alerts.correct_loc_id* column to discover where items should be taken. This
value is chosen by the *Job Monitor* with the following policy:

==============  ================= ===========================================
Item type       Location          *correct_loc_id*
==============  ================= ===========================================
Wrong model     Any               Set to the item origin, as it should be put
                                  back where it was picked up from.
Correct model   Wrong location    Set to the correct destination if the item
                                  origin matches an active task, or to the
                                  item origin otherwise.
Correct model   Correct location  Set to the item origin, as the clamp truck
                                  carried too many correct items and the
                                  outstanding ones have to be returned to
                                  their pickup location.
==============  ================= ===========================================
